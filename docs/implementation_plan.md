フェーズ概要
- フェーズ1: Walking Skeleton：最小構成で動画アップロードから解析結果表示までを通す／Issue #1-4
- フェーズ2: 自動化：チャット連携やリソース情報取得を通じて操作を自動化／Issue #5-7
- フェーズ3: 堅牢化：追加チャットやCLI対応など運用性を高める／Issue #8-10

依存関係マップ
#1 -> #2 -> #3 -> #4 -> #5 -> #8
#3 -> #7
#1 -> #6
#3 -> #9
#3 -> #10

Issueアウトライン表
Issue #1: FastAPI骨格の実装
- 概要: FastAPIアプリを作成し、テンプレートと静的ファイルの提供基盤を整える
- 依存: ー
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ ルート"/"が200を返しテンプレートを描画する
    ○ /static配下のファイルが参照できる
    ○ 基本設定値（デバイス・ディレクトリ）を環境変数から取得できる
    ○ AnalysisService/ChatbotServiceのスタブを配置する

Issue #2: 動画アップロードAPI
- 概要: 動画ファイルを受け取りローカルに保存しメタ情報を返す
- 依存: #1
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ POST /api/videos がmp4を受け取り安全なファイル名で保存する
    ○ 応答に動画IDとファイル名を含むJSONを返す
    ○ GET /api/videos/{id} がメタ情報を返す
    ○ 不正な形式は400で拒否する
    ○ 保存先ディレクトリが存在しない場合は自動作成される

Issue #3: 解析パイプラインとAPI
- 概要: OpenVINOでキーポイント抽出とスイングスコア算出を行うエンドポイントを実装
- 依存: #2
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ POST /api/analyses が参照動画IDと比較動画IDを受け取り非同期で解析する
    ○ キーポイントJSONとアノテーション動画を生成して保存する
    ○ compare_swings を用いて総合スコアと部位別スコアを算出する
    ○ GET /api/analyses/{id} が解析状態とスコアを返す
    ○ 失敗時に422 ANALYSIS_FAILED を返す

Issue #4: フロントエンドでの解析結果表示
- 概要: index.htmlとJSを用いて解析実行と骨格描画を行うUIを整備
- 依存: #3
- ラベル/担当: frontend
- 受け入れ基準（AC）:
    ○ ユーザーが動画を選択し解析を開始できる
    ○ 解析完了後にスコアと骨格付き動画が表示される
    ○ キーポイントJSONを読み込み動画再生に合わせて描画する
    ○ 推論デバイスの選択UIを提供する
    ○ 解析待機中は進捗表示を行う

Issue #5: スイングチャットボット連携
- 概要: 解析結果に基づき助言を返すチャット機能とAPIを実装
- 依存: #4
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ POST /api/messages が analysis_id とメッセージを受け取り応答を生成する
    ○ GET /api/messages?analysis_id=... が履歴を時系列で返す
    ○ ChatbotService が遅延初期化に対応し解析済みデータを利用する
    ○ チャットボット無効時には適切なエラーを返す
    ○ 最大履歴件数を超えると古いメッセージを削除する

Issue #6: システム使用率API
- 概要: CPU/GPU/NPUおよびメモリ使用率を返却するエンドポイントを追加
- 依存: #1
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ GET /api/system-usage がCPU/GPU/NPU/メモリ使用率を数値で返す
    ○ GPUやNPUが未対応の場合は0を返す
    ○ 取得処理が1秒以内に完了する
    ○ 異常時は500 INTERNAL_ERROR を返す

Issue #7: 解析結果の再利用
- 概要: 同一動画に対する解析をキャッシュし無駄な再処理を避ける
- 依存: #3
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ 動画ペアに対してキー ポイントJSONとスコアを保存する
    ○ POST /api/analyses が既存結果を検出し即座に返す
    ○ 再解析を強制するオプションを提供する
    ○ キャッシュヒット率をログに出力する

Issue #8: 一般向けチャットページ
- 概要: SimpleChatBot を利用した汎用LLMチャットを /chat で提供
- 依存: #5
- ラベル/担当: frontend
- 受け入れ基準（AC）:
    ○ /chat ページにテキスト入力と履歴表示を備える
    ○ チャットメッセージがSimpleChatBot経由で生成される
    ○ ページ離脱後もセッションIDで履歴を復元できる
    ○ エラーハンドリングと読み込み中表示を行う

Issue #9: CLI操作の実装
- 概要: コマンドラインから解析のみ/チャット起動/結果表示を切り替えられるCLIを提供
- 依存: #3
- ラベル/担当: infra
- 受け入れ基準（AC）:
    ○ `python -m golf_swing_compare --analyze` で解析のみ実行できる
    ○ `--show` オプションで骨格付き動画を再生できる
    ○ `--chat` オプションでチャットモードを起動できる
    ○ 不正な引数はヘルプとともにエラー終了する

Issue #10: 動画/デバイス切替API
- 概要: /set_videos エンドポイントで入力動画や推論デバイスを変更し解析状態をリセット
- 依存: #3
- ラベル/担当: backend
- 受け入れ基準（AC）:
    ○ POST /set_videos が新しい参照・比較動画パスとデバイスを受け取る
    ○ 変更後に以前の解析結果を破棄し初期状態に戻る
    ○ デバイスが無効な場合は400を返す
    ○ 変更内容がログ出力される

■ 実装要事項
- 疑問課題:
    - 動画IDや解析IDの永続化方法（ファイル名のみで十分か）
    - 対応する動画形式の制限範囲（mp4以外は許可するか）
    - GPU/NPU使用率取得の対応環境とライブラリ
    - チャットボットモデルのサイズとメモリ要件
    - 複数ユーザーアクセス時のセッション管理方針
