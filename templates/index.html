<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>ãƒãƒ£ãƒƒãƒˆ & å‹•ç”»</title>
  <link rel="stylesheet" href="{{ request.url_for('static', path='css/styles.css') }}?v=4">
</head>
<body>
  <!-- å‹•ç”» -->
  <div class="video-container">
    <div class="file-select">
      <label for="ref-upload">ãƒ—ãƒ­</label>
      <input id="ref-upload" type="file" accept="video/mp4" />
      <select id="ref-file"></select>
      <br />
      <label for="cur-upload">å¯¾è±¡</label>
      <input id="cur-upload" type="file" accept="video/mp4" />
      <select id="cur-file"></select>
      <br />
      <label for="device-select">ãƒ‡ãƒã‚¤ã‚¹</label>
      <select id="device-select">
        <option value="CPU">CPU</option>
        <option value="GPU">GPU</option>
        <option value="NPU">NPU</option>
      </select>
      <br />
      <button id="process-btn">æ›´æ–°</button>
    </div>
    <div id="status"></div>
    <hr class="usage-separator" />
    <div class="usage-title">H/Wä½¿ç”¨çŠ¶æ³</div>
    <div id="usage">
      <div class="usage-item"><span class="label"><span class="icon">ğŸ–¥</span>CPU</span><progress id="cpu-bar" max="100" value="0"></progress><span class="value" id="cpu-text">0%</span></div>
      <div class="usage-item"><span class="label"><span class="icon">ğŸ®</span>GPU</span><progress id="gpu-bar" max="100" value="0"></progress><span class="value" id="gpu-text">0%</span></div>
      <div class="usage-item"><span class="label"><span class="icon">ğŸ¤–</span>NPU</span><progress id="npu-bar" max="100" value="0"></progress><span class="value" id="npu-text">0%</span></div>
      <div class="usage-item">
        <span class="label"><span class="icon">ğŸ’¾</span>ãƒ¡ãƒ¢ãƒª</span>
        <progress id="mem-bar" max="100" value="0"></progress>
        <div class="value-detail">
          <span class="value" id="mem-text">0%</span>
          <!-- <span class="detail" id="mem-detail"></span> -->
        </div>
      </div>
    </div>
    {% if has_results %}
    <p>ã‚¹ã‚¤ãƒ³ã‚°ã‚¹ã‚³ã‚¢: {{ "%.4f"|format(score) }}</p>
    <div class="play-controls">
      <button id="play-both-btn">åŒæ™‚å†ç”Ÿ</button>
      <button id="stop-both-btn">åœæ­¢</button>
    </div>
    <div class="video-wrapper">
      <div class="video-item pro">
        <video id="ref-video" controls loop>
          <source src="{{ request.url_for('serve_video', filename=ref_video_name) }}" type="video/mp4">
          ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
        </video>
        <canvas id="ref-canvas"></canvas>
      </div>
      <div class="video-item target">
        <video id="cur-video" controls loop>
          <source src="{{ request.url_for('serve_video', filename=cur_video_name) }}" type="video/mp4">
          ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
        </video>
        <canvas id="cur-canvas"></canvas>
      </div>
    </div>
    {% endif %}
  </div>

  {% if chatbot_enabled %}
  <!-- ãƒãƒ£ãƒƒãƒˆ -->
  <div class="chat-container">
    <div id="chat-status" class="chat-status preparing">
      ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’æº–å‚™ä¸­ã§ã™ã€‚ã¾ãšå‹•ç”»ã‚’è§£æã—ã¦ãã ã•ã„ã€‚
    </div>
    <div id="chat-messages"></div>
    <div class="chat-input">
      <input id="chat-input" type="text" placeholder="è³ªå•ã—ã¦ã¿ã¾ã—ã‚‡ã†" disabled />
      <button id="send-btn" disabled title="é€ä¿¡">â¤</button>
    </div>
  </div>
  {% endif %}

  <script>
    window.APP_CONFIG = {
      hasResults: {{ 'true' if has_results else 'false' }},
      chatbotEnabled: {{ 'true' if chatbot_enabled else 'false' }},
      device: '{{ device }}',
      refKpUrl: '{{ request.url_for('static', path=ref_kp_name) }}',
      curKpUrl: '{{ request.url_for('static', path=cur_kp_name) }}',
      refVideoName: '{{ ref_video_name }}',
      curVideoName: '{{ cur_video_name }}'
    };
  </script>
  <script type="module" src="{{ request.url_for('static', path='js/main.js') }}?v=2"></script>
</body>
</html>

